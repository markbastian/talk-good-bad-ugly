<><html lang="en"><head><meta charset="utf-8" /><title>Clojure: State</title><meta content="Functional Programming: Writing Stateless Code in a Stateful World with Clojure" name="description" /><meta content="Mark Bastian" name="author" /><meta content="yes" name="apple-mobile-web-app-capable" /><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style" /><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui" name="viewport" /><link href="bower_components/reveal.js/css/reveal.css" rel="stylesheet" /><link href="bower_components/reveal.js/css/theme/default.css" id="theme" rel="stylesheet" /><!-- Code syntax highlighting --><link href="bower_components/reveal.js/lib/css/zenburn.css" rel="stylesheet" /><!-- Printing and PDF exports --><script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script><!--[if lt IE 9]>
		<script src="bower_components/html5shiv/dist/html5shiv.js"></script>
		<![endif]--></head><body><div class="reveal"><!-- Any section element inside of this container is displayed as a slide --><div class="slides"><section><h2>Example</h2><div style="float:left;width:400px;"><ul><li>Flocking Behaviors</li><li>Based on Craig Reynold's Flocking Algorithms</li><li>Completely Stateless*</li></ul></div><canvas height="400" id="flocking-canvas" width="400"></canvas><script src="js/flocking.js" type="text/javascript"></script><script type="text/javascript">flocking.game_launcher.launch_app(document.getElementById("flocking-canvas"), 400, 400, 20);</script></section><section><h2>Stateless Predator Prey</h2><canvas height="400" id="rk-canvas" style="border:1px solid #000000;" width="400"></canvas><div><small><label style="display: inline-block; width: 250px;">Initial Prey Population</label></small><input id="prey-population-slider" max="500" min="0" step="1" type="range" /></div><div><small><label style="display: inline-block; width: 250px;">Initial Predator Population</label></small><input id="predator-population-slider" max="500" min="0" step="1" type="range" /></div><div><small><label style="display: inline-block; width: 250px;">Reproduction Rate</label></small><input id="reproduction-rate-slider" max="500" min="0" step="1" type="range" /></div><div><small><label style="display: inline-block; width: 250px;">Predation Rate</label></small><input id="predation-rate-slider" max="500" min="0" step="1" type="range" /></div><div><small><label style="display: inline-block; width: 250px;">Growth Rate</label></small><input id="growth-rate-slider" max="500" min="0" step="1" type="range" /></div><div><small><label style="display: inline-block; width: 250px;">Death Rate</label></small><input id="death-rate-slider" max="500" min="0" step="1" type="range" /></div><script src="js/rk.js" type="text/javascript"></script><script type="text/javascript">numerics.canvasui.init(document.getElementById("rk-canvas"));</script></section><section><h2>Data Modeling Tips</h2><ul><li>Entity Maps</li><li>Cycles via identifiers</li><li>Use UUIDs or other unique identifiers</li><li>Names make poor identifiers</li></ul></section><section><h2>Functional Programming</h2><h4>Writing Stateless Code in a Stateful World with Clojure</h4><p>Mark Bastian</p><small><p><a href="mailto:markbastian@gmail.com?Subject=Syntax">markbastian@gmail.com</a></p><p><a href="https://twitter.com/mark_bastian">@mark_bastian</a></p></small><p>3/24/2015</p></section><section><h2>Overview</h2><ul><li>Functional Programming</li><li>State and Statelessness</li><li>Getting There</li><li>Examples</li></ul></section><section><section><h2>Functional Programming</h2></section><section><h2>What is Functional Programming?</h2><blockquote cite="http://en.wikipedia.org/wiki/Functional_programming">&ldquo;In computer science, functional programming is a programming paradigm, a style of building the structure and
  elements of computer programs, that treat computation as the evaluation of mathematical functions and avoids
  changing-stat and mutable data.&rdquo;</blockquote><span style="position:absolute;bottom:-10;right:150;font-size:0.5em">http://en.wikipedia.org/wiki/Functional_programming</span></section><section><h2>Tenets of Functional Programming</h2><ul><li>Functions: Relations that consistently map an input to a single output</li><li>Data is immutable (values)</li><li>Functions have no side-effects</li></ul></section><section><h2>Functions</h2><ul><li>Functions are types in FP, not just methods<ul><li>They can be assigned</li><li>They can be passed around and returned</li></ul></li><li>FP Functions are Mathematical Functions, with all of their special properties:<ul><li>Consistent results</li><li>Composition, substitution, partial evaluation, etc.</li></ul></li></ul></section><section><h2>Values</h2><ul><li>Values are immutable</li><li>Primitives (double, int, string, etc.) are values</li><li>Value Types and Immutable Collections: Immutable classes with equality and hashcode</li><li>Values are implicitly concurrent</li><li>Values don't require deep copying since they can share history</li><li>Values are required for functional consistency</li><li>Values are easy to reason about</li><li>In FP, it's values all the way down</li></ul></section><section><h2>No Side Effects</h2><ul><li>Anything that affects computation besides the function internals is a side effect</li><li>Mathematical functions have no side-effects</li><li>Examples of side-effects include disk i/o, printing, rendering, and loading configuration files</li><li>In practice, there will be side-effects</li><li>FP seeks to minimize and contain them</li><li>Watch &ldquo;The Value of Values&rdquo; by Rich Hickey</li></ul></section><section><h2>Why FP?</h2><ul><li>Implicit concurrency</li><li>Code is easier to reason about</li><li>Greater reuse</li><li>Easier abstractions lead to less code</li></ul></section><section><h2>Functional Programming is Awesome!</h2></section><section><h2>However...</h2><ul><li>FP tends to be very confusing coming from an OOP background</li><li>How can you do anything useful when there is no state or side-effects?<ul><li>The world has state....</li><li>FP has no state...</li></ul></li><li>That is what this talk is about</li></ul></section></section><section><section><h1>State</h1></section><section><h2>What is State?</h2><blockquote cite="https://en.wikipedia.org/wiki/State">&ldquo;State, a complete description of a system in classical mechanics&rdquo;</blockquote><span style="position:relative;bottom:0;right:-210;font-size:0.5em">https://en.wikipedia.org/wiki/State</span><blockquote cite="https://www.google.com/search?q=what+is+state&amp;oq=what+is+state">&ldquo;the particular condition that someone or something is in at a specific time.&rdquo;</blockquote><span style="position:relative;bottom:0;right:-80;font-size:0.5em">https://www.google.com/search?q=what+is+state&oq=what+is+state</span></section><section><h2>What is State?</h2><ul><li>State: A representation of the current computational universe</li><li>Often confusing because of differing definitions across communities</li><li>There are two kinds of state:<ul><li>Mutable: A changeable variable used to represent the &ldquo;current&rdquo; state of computation<ul><li>This is OOP state</li></ul></li><li>Immutable: A single, non-changing, constant value<ul><li>This is FP state</li></ul></li></ul></li></ul></section><section><h2>But...</h2><ul><li>If nothing changes, how does anything happen?</li><li>An analogy...</li></ul></section><section><h2>The Traditional Universe</h2><ul><li>Time flows forward like a river</li><li>Things/events happen</li><li>State is the management of all possible events and conditions in the universe</li><li>This is the object-oriented view of reality</li></ul></section><section><h2>The Multiverse</h2><ul><li>A universe is a single, discrete, immutable value frozen in time</li><li>There are infinitely many of these universes</li><li>Events are &ldquo;Quantum Leaps&rdquo; into a different universe</li><li>State is simply a reference to one or more universes of interest</li><li>This is the functional view of reality</li></ul></section><section><h2>What if things were Multiversic?</h2><ul><li>It is trival to keep track of multiple universes</li><li>It is trivial to inspect a universe</li><li>Universes can share commonalities so no need to completely reconstruct</li></ul></section><section><h2>Concerns of State in Either Model</h2><ul><li>Representation: How do I represent a given item?</li><li>Management: How do I keep track of items(s) of interest?</li><li>Transition: How do I get from one representation to another?</li></ul></section><section><h2>Universal/OOP State Management</h2><ul><li>Representation: A mutable instance of a class<ul><li>This is where most of your changes occur</li></ul></li><li>Management: A reference to one or more mutable objects<ul><li>Often doesn't change much</li></ul></li><li>Transition: Getters, setters, and methods on tracked mutable objects<ul><li>Objects and methods are inextricably linked</li></ul></li></ul></section><section><h2>Multiversal/FP State Management</h2><ul><li>Representation: An immutable value representing the current state(s) of interest (data)<ul><li>Never changes</li></ul></li><li>Management: A concurrency primitive(s) holding a reference to the value(s) of interest<ul><li>This is where most of your changes occur</li></ul></li><li>Transition: Functions<ul><li>Objects and methods are independent of each other.</li></ul></li></ul></section><section><h2>Pros/Cons of Mutable State</h2><ul><li>Pros<ul><li>Generally conceptully easier to think about</li><li>Performance can be better (with caveats)</li></ul></li><li>Cons<ul><li>Concurrency is non-trivial</li><li>There is no separation of concerns</li><li>Representation, management, and transition are tied together</li></ul></li></ul></section><section><h2>Pros/Cons of Immutable State</h2><ul><li>Pros<ul><li>Concurrency is implicit</li><li>Concerns are completely separated</li></ul></li><li>Cons<ul><li>Often a difficult idea to get your head wrapped around</li><li>Not all languages support this model</li></ul></li></ul></section><section><h2>Since this talks is on FP...</h2><ul><li>Immutability is obviously better</li><li>We'll now talk about how to do it</li></ul></section></section><section><section><h1>How</h1></section><section><h2>FP in Practice</h2><ul><li>A practical roadmap of how to get there</li><li>What languages support each stage</li></ul></section><section><h2>Stages of FP</h2><ul><li>Lambdas/Closures/First Class Functions</li><li>Persistent collections</li><li>Immutable classes</li><li>Concurrent state management</li></ul></section><section><h2>Lambdas/Closures</h2><ul><li>Lambdas are simply anonymous functions</li><li>Closures are lambdas that </li></ul></section><section><h2>Persistent Collections</h2><ul><li>Immutable</li><li>Shared data for efficiency and speed</li><li>Functional operations</li></ul></section><section><h2>Value Classes</h2><ul><li>Final</li><li>Implement equals and hashcode</li><li>Often have convenience methods for 1-off copies</li><li>Language support<ul><li>Java: No</li><li>Scala: Case classes</li><li>Clojure: defrecords, but everyone uses persistent collections instead</li></ul></li></ul></section><section><h2>Managing State Concurrently</h2><ul><li>Java: No</li><li>Scala: No, but you can use Akka</li><li>Clojure: Yes - and you can use it in Java or Scala</li></ul></section><section><h2>Clojure Concurrency Primitives</h2><ul><li>Atoms<ul><li>Synchronous, Uncoordinated</li><li>The workhorse of Clojure concurrency</li></ul></li><li>Agents<ul><li>Asynchronous, Uncoordinated</li><li>Reactive</li></ul></li><li>Refs<ul><li>Synchronous, Coordinated</li><li>Banking and other transactional operations</li></ul></li></ul></section></section><section><section><h2>State Management</h2><ul><li>Ultimately, you will likely need persistent references to changing values</li><li>Clojure provides facilities for managing these references</li><li>Reference types<ul><li>Atoms: Uncoordinated, synchronous</li><li>Refs: Coordinated, synchronous</li><li>Agents: Independent, asynchronous</li></ul></li></ul></section></section><section><h2>Other Languages?</h2><ul><li>Scala<ul><li>Akka</li><li>Not baked in</li><li>Actors</li><li>STM</li></ul></li><li>Clojure<ul><li>Batteries included</li></ul></li></ul></section><section><h2>In Conclusion:</h2><h2>Yes, you can be stateless</h2><ul><li>It's a different way of thinking</li><li>Threading and api design</li><li>Come see my other talk</li></ul></section></div></div><script src="bower_components/reveal.js/lib/js/head.min.js"></script><script src="bower_components/reveal.js/js/reveal.js"></script><script src="MathJax.Hub.Config({
        tex2jax: {inlineMath: [[&amp;quot;$&amp;quot;,&amp;quot;$&amp;quot;],[&amp;quot;\(&amp;quot;,&amp;quot;\)&amp;quot;]]}
      });" type="text/x-mathjax-config"></script><script src="bower_components/MathJax/MathJax.js?config=TeX-AMS_HTML-full" type="text/javascript"></script><script src="js/reveal-cl.js" type="text/javascript"></script></body></html></>