<!DOCTYPE html>
<html><head><meta charset="utf-8"><title>Clojure: State</title><meta content="Functional Programming: Writing Stateless Code in a Stateful World with Clojure" name="description"><meta content="Mark Bastian" name="author"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui" name="viewport"><link href="bower_components/reveal.js/css/reveal.css" rel="stylesheet" type="text/css"><link href="bower_components/reveal.js/css/theme/black.css" rel="stylesheet" type="text/css"><link href="bower_components/reveal.js/lib/css/zenburn.css" rel="stylesheet" type="text/css"><!-- Printing and PDF exports --><script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script><!--[if lt IE 9]>
		<script src="bower_components/html5shiv/dist/html5shiv.js"></script>
		<![endif]--></head><body><div class="reveal"><!-- Any section element inside of this container is displayed as a slide --><div class="slides"><section><h2>Vars</h2><p>Thread-Local Binding</p><pre style="float:left;width:48%;height:100%;font-size:40%;"><code class="clj" contenteditable="contenteditable" data-trim="data-trim">(def ^:dynamic *a* 0)
(def ^:dynamic *b* 1)

(prn (str &quot;original a, b = &quot; *a* &quot;,&quot; *b*))

(binding [*a* 1 *b* 0]
  (prn (str &quot;rebound a, b = &quot; *a* &quot;,&quot; *b*))
  (binding [*a* 11 *b* 45]
    (prn (str &quot;rebound a, b = &quot; *a* &quot;,&quot; *b*)))
  (prn (str &quot;popped a, b = &quot; *a* &quot;,&quot; *b*)))

(prn (str &quot;popped a, b = &quot; *a* &quot;,&quot; *b*))</code></pre><pre style="float:right;width:48%;height:100%;"><code class="clj" contenteditable="contenteditable" data-trim="data-trim">&quot;original a, b = 0,1&quot;
&quot;rebound a, b = 1,0&quot;
&quot;rebound a, b = 11,45&quot;
&quot;popped a, b = 1,0&quot;
&quot;popped a, b = 0,1&quot;</code></pre></section><section><h2>Atoms</h2><p>Uncoordinated, Synchronous</p><pre style="float:left;width:48%;height:100%;font-size:40%;"><code class="clj" contenteditable="contenteditable" data-trim="data-trim">(def a (atom 0))
(def b (atom 1))

(defn slow [f] (Thread/sleep 300) f)
(defn slower [f] (Thread/sleep 400) f)

(future
  (do
    (swap! a (comp slow inc))
    (swap! b (comp slower dec))))

(future
  (loop [i 10]
    (when (pos? i)
      (do
        (prn (str &quot;a, b = &quot; @a &quot;,&quot; @b))
        (Thread/sleep 100)
        (recur (dec i))))))</code></pre><pre style="float:right;width:48%;height:100%;"><code class="clj" contenteditable="contenteditable" data-trim="data-trim">&quot;a, b = 0,1&quot;
&quot;a, b = 0,1&quot;
&quot;a, b = 0,1&quot;
&quot;a, b = 1,1&quot; ;slow completes
&quot;a, b = 1,1&quot;
&quot;a, b = 1,1&quot;
&quot;a, b = 1,1&quot;
&quot;a, b = 1,0&quot; ;slower completes
&quot;a, b = 1,0&quot;
&quot;a, b = 1,0&quot;</code></pre></section><section><h2>Agents</h2><p>Uncoordinated, Asynchronous</p><pre style="float:left;width:48%;height:100%;font-size:40%;"><code class="clj" contenteditable="contenteditable" data-trim="data-trim">(def a (agent 0))
(def b (agent 1))

(defn slow [f] (Thread/sleep 300) f)
(defn slower [f] (Thread/sleep 400) f)

(future
  (do
    (send a (comp slow inc))
    (send b (comp slower dec))))

(future
  (loop [i 10]
    (when (pos? i)
      (do
        (prn (str &quot;a, b = &quot; @a &quot;,&quot; @b))
        (Thread/sleep 100)
        (recur (dec i))))))</code></pre><pre style="float:right;width:48%;height:100%;"><code class="clj" contenteditable="contenteditable" data-trim="data-trim">&quot;a, b = 0,1&quot; ;Both sends immediately return
&quot;a, b = 0,1&quot;
&quot;a, b = 0,1&quot;
&quot;a, b = 1,1&quot; ;slow completes
&quot;a, b = 1,0&quot; ;slower completes
&quot;a, b = 1,0&quot;
&quot;a, b = 1,0&quot;
&quot;a, b = 1,0&quot;
&quot;a, b = 1,0&quot;
&quot;a, b = 1,0&quot;</code></pre></section><section><h2>Channels</h2><p>Coordinated, Synchronous</p><pre style="float:left;width:48%;height:100%;font-size:40%;"><code class="clj" contenteditable="contenteditable" data-trim="data-trim">(def a (ref 0))
(def b (ref 1))

(defn slow [f] (Thread/sleep 300) f)
(defn slower [f] (Thread/sleep 400) f)

(future
  (dosync
    (alter a (comp slow inc))
    (alter b (comp slower dec))))

(future
  (loop [i 10]
    (when (pos? i)
      (do
        (prn (str &quot;a, b = &quot; @a &quot;,&quot; @b))
        (Thread/sleep 100)
        (recur (dec i))))))</code></pre><pre style="float:right;width:48%;height:100%;"><code class="clj" contenteditable="contenteditable" data-trim="data-trim">&quot;a, b = 0,1&quot;
&quot;a, b = 0,1&quot;
&quot;a, b = 0,1&quot;
&quot;a, b = 0,1&quot; ;slow completes?
&quot;a, b = 0,1&quot;
&quot;a, b = 0,1&quot;
&quot;a, b = 0,1&quot;
&quot;a, b = 1,0&quot; ;both actions complete
&quot;a, b = 1,0&quot;
&quot;a, b = 1,0&quot;</code></pre></section><section><h2>State Management</h2><ul><li>Ultimately, you will likely need persistent references to changing values</li><li>Clojure provides facilities for managing these references</li><li>Reference types<ul><li>Atoms: Uncoordinated, synchronous</li><li>Refs: Coordinated, synchronous</li><li>Agents: Independent, asynchronous</li></ul></li></ul></section></div></div><script src="bower_components/reveal.js/lib/js/head.min.js" type="text/javascript"></script><script src="bower_components/reveal.js/js/reveal.js" type="text/javascript"></script><script src="bower_components/MathJax/MathJax.js?config=TeX-AMS_HTML-full" type="text/javascript"></script><script src="js/reveal-cl.js" type="text/javascript"></script><script src="MathJax.Hub.Config({
        tex2jax: {inlineMath: [[&amp;quot;$&amp;quot;,&amp;quot;$&amp;quot;],[&amp;quot;\(&amp;quot;,&amp;quot;\)&amp;quot;]]}
      });" type="text/x-mathjax-config"></script></body></html>